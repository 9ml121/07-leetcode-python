"""
ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° m ï¼Œä½ éœ€è¦å°†è¿™ä¸ªæ•°ç»„åˆ†æˆ m ä¸ªéç©ºçš„è¿ç»­å­æ•°ç»„ã€‚
è®¾è®¡ä¸€ä¸ªç®—æ³•ä½¿å¾—è¿™ m ä¸ªå­æ•°ç»„å„è‡ªå’Œçš„æœ€å¤§å€¼æœ€å°ã€‚

ç¤ºä¾‹ 1ï¼š
è¾“å…¥ï¼šnums = [7,2,5,10,8], m = 2
è¾“å‡ºï¼š18
è§£é‡Šï¼š
ä¸€å…±æœ‰å››ç§æ–¹æ³•å°† nums åˆ†å‰²ä¸º 2 ä¸ªå­æ•°ç»„ã€‚
å…¶ä¸­æœ€å¥½çš„æ–¹å¼æ˜¯å°†å…¶åˆ†ä¸º [7,2,5] å’Œ [10,8] ã€‚
å› ä¸ºæ­¤æ—¶è¿™ä¸¤ä¸ªå­æ•°ç»„å„è‡ªçš„å’Œçš„æœ€å¤§å€¼ä¸º18ï¼Œåœ¨æ‰€æœ‰æƒ…å†µä¸­æœ€å°ã€‚

ç¤ºä¾‹ 2ï¼š
è¾“å…¥ï¼šnums = [1,2,3,4,5], m = 2
è¾“å‡ºï¼š9

ç¤ºä¾‹ 3ï¼š
è¾“å…¥ï¼šnums = [1,4,4], m = 3
è¾“å‡ºï¼š4


æç¤ºï¼š
1 <= nums.n <= 1000
0 <= nums[i] <= 10^6
1 <= m <= min(50, nums.n)
"""
from typing import List

# todo äºŒåˆ†æŸ¥æ‰¾ | åŠ¨æ€è§„åˆ’

# todo æ–¹æ³•1ï¼šäºŒåˆ†ç­”æ¡ˆï¼ˆæ¨èï¼ï¼‰
class Solution:
    def splitArray(self, nums: List[int], k: int) -> int:
        # å°†æ•°ç»„numsåˆ†å‰²ä¸ºkä¸ªå­æ•°ç»„ï¼Œæ±‚å„ç§åˆ†å‰²æ–¹å¼ä¸­å„ä¸ªå­æ•°ç»„ä¸­çš„æœ€å¤§å€¼çš„æœ€å°å€¼
        n = len(nums)
        # 1.å½“k=n, ä¹Ÿå°±æ˜¯numsæ¯ä¸ªæ•°éƒ½æ˜¯ä¸€ä¸ªå­æ•°ç»„ï¼Œæ­¤æ—¶å­æ•°ç»„å’Œçš„æœ€å¤§å€¼æœ€å°ï¼Œä¸ºmax(nums)
        lo = max(nums)
        # 2.å½“k=1,ä¹Ÿå°±æ˜¯numsåˆ’åˆ†ä¸ºä¸€ä¸ªå­æ•°ç»„ï¼Œæ­¤æ—¶å­æ•°ç»„å’Œçš„æœ€å¤§å€¼æœ€å¤§ï¼Œä¸ºsum(nums)
        hi = sum(nums)
        
        def getSplitCnt(limit: int) -> int:
            """è®¡ç®—å­æ•°ç»„å„è‡ªå’Œçš„æœ€å¤§å€¼ä¸ºlimitæ—¶ï¼Œåˆ’åˆ†å­æ•°ç»„çš„ä¸ªæ•°splits"""
            splits = 1  # è‡³å°‘æ˜¯ä¸€ä¸ªåˆ†å‰²
            cur_sum = 0  # å½“å‰åŒºé—´çš„å’Œ
            for num in nums:
                # å°è¯•åŠ ä¸Šå½“å‰éå†çš„è¿™ä¸ªæ•°ï¼Œå¦‚æœåŠ ä¸Šå»è¶…è¿‡äº†ã€Œå­æ•°ç»„å„è‡ªçš„å’Œçš„æœ€å¤§å€¼ã€ï¼Œå°±ä¸åŠ è¿™ä¸ªæ•°ï¼Œå¦èµ·ç‚‰ç¶
                if cur_sum + num > limit:
                    cur_sum = 0
                    splits += 1
                cur_sum += num

            return splits
        
        # 3.å½“1 < k < nï¼Œå­æ•°ç»„å„è‡ªå’Œçš„æœ€å¤§å€¼ä¸€å®šä»‹å…¥[lo..hi]ä¹‹é—´
        while lo < hi:
            mid = (lo + hi) >> 1
            # è®¡ç®—å­æ•°ç»„å„è‡ªå’Œçš„æœ€å¤§å€¼ä¸ºmidæ—¶ï¼Œå¯ä»¥åˆ’åˆ†çš„å­æ•°ç»„æœ€å°‘ä¸ªæ•°splits
            splits = getSplitCnt(mid)
            if splits > k:
                # 1.åˆ’åˆ†å­æ•°ç»„ä¸ªæ•°å¤šäº†ï¼Œä¹Ÿå°±æ˜¯midçŒœå°äº†ï¼Œmidå’Œmidå·¦è¾¹ä¸€å®šä¸æ˜¯è¦æ±‚çš„è§£
                # ä¸‹ä¸€è½®åœ¨[mid+1..hi]æœç´¢
                lo = mid + 1
            else:
                # 2.å¦‚æœsplits <= k, è¯´æ˜midå¯èƒ½çŒœå¤§äº†ï¼Œç»§ç»­æŸ¥æ‰¾[lo..mid]æœ‰æ²¡æœ‰æ›´å°çš„å­æ•°ç»„å’Œ
                hi = mid
        
        return lo


# todo æ–¹æ³•2: åŒºé—´dp + å‰ç¼€å’Œ
"""
Â§6.3 çº¦æŸåˆ’åˆ†ä¸ªæ•°
å°†æ•°ç»„åˆ†æˆï¼ˆæ°å¥½/è‡³å¤šï¼‰ğ‘˜ ä¸ªè¿ç»­å­æ•°ç»„ï¼Œè®¡ç®—ä¸è¿™äº›å­æ•°ç»„æœ‰å…³çš„æœ€ä¼˜å€¼ã€‚
ä¸€èˆ¬å®šä¹‰ ğ‘“[ğ‘–][ğ‘—] è¡¨ç¤ºå°†é•¿ä¸º ğ‘— çš„å‰ç¼€a[:j] åˆ†æˆ ğ‘– ä¸ªè¿ç»­å­æ•°ç»„æ‰€å¾—åˆ°çš„æœ€ä¼˜è§£ã€‚
æšä¸¾æœ€åä¸€ä¸ªå­æ•°ç»„çš„å·¦ç«¯ç‚¹ ğ¿ï¼Œä» ğ‘“[ğ‘–âˆ’1][ğ¿]è½¬ç§»åˆ° ğ‘“[ğ‘–][ğ‘—]ï¼Œå¹¶è€ƒè™‘ ğ‘[ğ¿:ğ‘—] å¯¹æœ€ä¼˜è§£çš„å½±å“ã€‚
"""
class Solution2:
    def splitArray(self, nums: List[int], k: int) -> int:
        # å°†æ•°ç»„numsåˆ†å‰²ä¸ºkä¸ªå­æ•°ç»„ï¼Œæ±‚å„ç§åˆ†å‰²æ–¹å¼ä¸­å„ä¸ªå­æ•°ç»„ä¸­çš„æœ€å¤§å€¼çš„æœ€å°å€¼
        n = len(nums)
        # todo dp[i][j] è¡¨ç¤ºä¸‹æ ‡[0..i]åˆ†å‰²æˆ j ä¸ªéç©ºè¿ç»­å­æ•°ç»„æ‰€å¾—åˆ°çš„å­æ•°ç»„ä¸­çš„æœ€å¤§å€¼çš„æœ€å°å€¼ã€‚
        dp = [[float('inf')] * (k + 1) for _ in range(n)]

        pre_sum = [0] * (n + 1)  # å‰ç¼€å’Œæ•°ç»„,pre_sum[i]ä»£è¡¨nums[i+1]ä¹‹å‰çš„å…ƒç´ å’Œ
        for i in range(n):
            pre_sum[i + 1] = pre_sum[i] + nums[i]
            # ä¸‹æ ‡[0..i]åˆ†å‰²æˆ 1 ä¸ªéç©ºè¿ç»­å­æ•°ç»„
            dp[i][1] = pre_sum[i + 1]

        for i in range(1, n):  # ä»å­æ•°ç»„[0..1],æšä¸¾åˆ°[0..n-1]
            for j in range(2, min(i + 1, k) + 1):  # åˆ†å‰²å­æ•°ç»„æ•°,ä»2ä¸ªå¼€å§‹ï¼Œæœ€å¤šmin(k, i+1)ä¸ª
                for t in range(j - 2, i):  # tæšä¸¾æœ€åä¸€ä¸ªå­æ•°ç»„çš„èµ·ç‚¹
                    max_val = max(dp[t][j - 1], pre_sum[i + 1] - pre_sum[t + 1])
                    dp[i][j] = min(dp[i][j], max_val)

        return dp[n - 1][k]




# äºŒåˆ†ç­”æ¡ˆå†™æ³•2
class Solution3:
    def splitArray(self, nums: List[int], k: int) -> int:
        # å°†æ•°ç»„numsåˆ†å‰²ä¸ºkä¸ªå­æ•°ç»„ï¼Œæ±‚å„ç§åˆ†å‰²æ–¹å¼ä¸­å„ä¸ªå­æ•°ç»„ä¸­çš„æœ€å¤§å€¼çš„æœ€å°å€¼
        n = len(nums)
        # 1.å½“k=n, ä¹Ÿå°±æ˜¯numsæ¯ä¸ªæ•°éƒ½æ˜¯ä¸€ä¸ªå­æ•°ç»„ï¼Œæ­¤æ—¶å­æ•°ç»„å’Œçš„æœ€å¤§å€¼æœ€å°ï¼Œä¸ºmax(nums)
        lo = max(nums)
        # 2.å½“k=1,ä¹Ÿå°±æ˜¯numsåˆ’åˆ†ä¸ºä¸€ä¸ªå­æ•°ç»„ï¼Œæ­¤æ—¶å­æ•°ç»„å’Œçš„æœ€å¤§å€¼æœ€å¤§ï¼Œä¸ºsum(nums)
        hi = sum(nums)
        
        # åˆ¤æ–­å¯ä¸å¯èƒ½å°†numsåˆ†ä¸ºkä¸ªå­æ•°ç»„ï¼Œä½¿å¾—å­æ•°ç»„å„è‡ªå’Œéƒ½<=limit
        def canSplit(k:int, limit:int)->bool:
            # æ¯æ¬¡åˆ†å‰²éƒ½å°½é‡æŠŠlimitç”¨å®Œï¼Œæœ€ååˆ¤æ–­k=0çš„æ—¶å€™numsè¿˜æœ‰æ²¡æœ‰å‰©ä½™å…ƒç´ 
            i = 0
            while i < n:
                if k == 0:
                    return False
        
                tmp = limit
                while i < n and tmp >= nums[i]:
                    tmp -= nums[i]
                    i += 1
                k -= 1
            return True

        # 3.å½“1 < k < len(nums)ï¼Œå­æ•°ç»„å„è‡ªå’Œçš„æœ€å¤§å€¼ä¸€å®šä»‹å…¥[max(nums)..sum(nums)]ä¹‹é—´ï¼Œå› ä¸ºnumsç»™çš„æ˜¯éè´Ÿæ•´æ•°
        while lo < hi:
            mid = (lo + hi) >> 1
            if self.canSplit(nums, k, mid):
                hi = mid  # ç»§ç»­å‡å°‘midV
            else:
                # å¢å¤§mid: å­æ•°ç»„å’Œçš„æœ€å¤§å€¼çš„æœ€å°å€¼è¶Šå¤§ï¼Œæ•°ç»„åˆ†æ³•å°±è¶Šå¤š
                lo = mid + 1
        return lo

# dp + ä¸ç”¨å‰ç¼€å’Œ:è¶…æ—¶
class Solution4:
    def splitArray(self, nums: List[int], k: int) -> int:
        n = len(nums)
        # dp[i][j] è¡¨ç¤ºå°†æ•°ç»„çš„å‰ i ä¸ªå…ƒç´ åˆ†å‰²æˆ j ä¸ªéç©ºè¿ç»­å­æ•°ç»„æ‰€å¾—åˆ°çš„å­æ•°ç»„ä¸­çš„æœ€å¤§å€¼çš„æœ€å°å€¼ã€‚
        dp = [[float('inf')] * (k + 1) for _ in range(n)]
        # åˆå§‹åŒ–ï¼šå¦‚æœ j == 1ï¼Œè¡¨ç¤ºå½“å‰ä½ç½®åªéœ€åˆ†å‰²ä¸ºä¸€ä¸ªå­æ•°ç»„ï¼Œå³æ•´ä¸ªæ•°ç»„ä½œä¸ºä¸€ä¸ªå­æ•°ç»„ï¼Œæ­¤æ—¶ dp[i][j] çš„å€¼ä¸ºå½“å‰ä½ç½®å‰é¢æ‰€æœ‰å…ƒç´ çš„å’Œ
        dp[0][1] = nums[0]
        for i in range(1, n):
            dp[i][1] = dp[i - 1][1] + nums[i]

        for i in range(1, n):  # iä»£è¡¨æ•°ç»„çš„å‰ i ä¸ªå…ƒç´ 
            for j in range(2, min(i + 2, k + 1)):  # jä»£è¡¨åˆ†å‰²çš„å­æ•°ç»„ä¸ªæ•°
                for t in range(j - 2, i):  # åˆ†æˆ2æ®µä»¥ä¸Šï¼Œkæšä¸¾æœ€åä¸€æ®µçš„åˆ†å‰²ç‚¹
                    # å°†æ•°ç»„çš„å‰ t ä¸ªå…ƒç´ åˆ†å‰²ä¸º j-1 ä¸ªå­æ•°ç»„ï¼Œ
                    # å°†ä½ç½® t+1 åˆ°ä½ç½® i çš„å…ƒç´ ä½œä¸ºç¬¬ j ä¸ªå­æ•°ç»„ã€‚
                    # è®¡ç®—è¿™2ä¸ªæ•°ç»„çš„æœ€å¤§å€¼ max_val
                    max_val = max(dp[t][j - 1], sum(nums[t + 1:i + 1]))
                    # æ›´æ–° dp[i][j] çš„å€¼ä¸ºæ‰€æœ‰ max_val ä¸­çš„æœ€å°å€¼ã€‚
                    dp[i][j] = min(dp[i][j], max_val)
        # æœ€ç»ˆï¼Œdp[n-1][m] å³ä¸ºåˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼çš„æœ€å°å€¼ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ nums çš„é•¿åº¦ã€‚
        return dp[n - 1][k]


if __name__ == '__main__':
    nums = [7, 2, 5, 10, 8]
    k = 2  # è¾“å‡º18
    # nums = [5, 1, 4, 1, 6, 1]
    # k = 4  # è¾“å‡º6
    print(Solution().splitArray(nums, k))
    print(Solution2().splitArray(nums, k))
    print(Solution3().splitArray(nums, k))
    print(Solution4().splitArray(nums, k))
